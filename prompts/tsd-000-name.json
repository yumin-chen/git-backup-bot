{
  "version": "3.0",
  "date": "2025-12-01",
  "status": "production-ready",
  "license": "MIT/Apache-2.0",
  "executive_summary": {
    "objective": "Automated backup and revision archival system in Go using a containerized Jujutsu (jj) VCS runtime. Watches directories with jj's native watcher, commits to a shadow jj repo, and pushes to remote Git/JJ endpoints.\n",
    "scope": {
      "in_scope": [
        "Jujutsu-based file monitoring and revisioning",
        "Containerized shadow environment",
        "Multi-remote sync (Git/JJ/Gitea/Codeberg)",
        "Restore operations",
        "Observability & health",
        "Optional encryption layer"
      ],
      "out_of_scope": [
        "Real-time block-level replication",
        "Windows support (initial release Linux/macOS only)",
        "Native Git manipulation (only via Jujutsu Git interop)"
      ]
    }
  },
  "technology_stack": {
    "core_dependencies": [
      {
        "name": "Go 1.23+",
        "type": "language",
        "governance": "Open Source"
      },
      {
        "name": "Jujutsu (jj)",
        "type": "vcs_engine",
        "governance": "EU/Global"
      },
      {
        "name": "Jujutsu builtin fswatch",
        "type": "watcher",
        "governance": "EU"
      },
      {
        "name": "Podman / Docker",
        "type": "container_runtime",
        "governance": "Open Source"
      },
      {
        "name": "SQLite (Go bindings)",
        "type": "state_storage",
        "governance": "Public Domain"
      },
      {
        "name": "age or GPG",
        "type": "encryption",
        "governance": "Open Source"
      },
      {
        "name": "go-yaml",
        "type": "config_parser",
        "governance": "Open Source"
      }
    ],
    "remote_storage": {
      "providers": [
        {
          "name": "Gitea",
          "self_hosted": true,
          "open_source": "MIT",
          "jurisdiction": "N/A"
        },
        {
          "name": "Codeberg",
          "self_hosted": "community",
          "open_source": "MIT",
          "jurisdiction": "Germany"
        },
        {
          "name": "GitLab (self-managed)",
          "self_hosted": true,
          "open_source": "MIT",
          "jurisdiction": "US/EU"
        }
      ]
    }
  },
  "architecture": {
    "high_level_overview": "Two-container architecture: backup-bot (Go binary) and jj-sidecar (Jujutsu runtime).",
    "components": {
      "backup_bot": [
        "Config Parser (YAML)",
        "State Database (SQLite)",
        "Queue Manager",
        {
          "Sync Manager (jj": "add -> commit -> push)"
        },
        "Encryption layer",
        "Metrics & Health",
        "Restore Manager"
      ],
      "jj_sidecar": [
        "Shadow workspace",
        "Operation log",
        "Clean DAG",
        "Filesystem watcher (jj native)",
        "Temp workspace",
        "Git interoperability"
      ]
    }
  },
  "execution_flow": [
    "jj-sidecar watches host-mounted directories.",
    "jj updates workspace \"dirty\" state, emits event.",
    "backup-bot receives and debounces change events.",
    "Stages changes, creates jj operation and revision.",
    "Pushes revision to remote.",
    "State stored in SQLite."
  ],
  "functional_requirements": {
    "file_monitoring": {
      "watcher": "Jujutsu built-in file watcher",
      "debounce_seconds": 10,
      "respects_jj_ignore": true,
      "follow_symlinks_configurable": true
    },
    "jujutsu_operations": {
      "track": "jj track",
      "new_commit": "jj new",
      "describe": "jj describe",
      "branching_strategy": "backup/<HOST>/<DIR_NAME>",
      "push": "jj git push <remote> --branch backup/<...>"
    },
    "git_lfs_equivalent": {
      "import": "jj git-lfs import",
      "push": "jj git-lfs push"
    },
    "restore_operations": [
      "List jj revisions",
      "Checkout revision to temporary workspace",
      "Restore individual files or entire tree",
      "Verify against jj's object hash"
    ]
  },
  "non_functional_requirements": {
    "performance": {
      "file_detection_latency_ms": "<250",
      "commit_creation_seconds": "<5 for 1000 files",
      "memory_usage_mb": "<120",
      "queue_throughput_events_per_sec": ">1000"
    },
    "reliability": [
      "jj operation log in shadow container",
      "SQLite checkpointing",
      "Restart-safe file monitoring"
    ],
    "security": [
      "Full isolation by containerizing jj",
      "No secret storage in logs",
      "Optional age-encryption"
    ],
    "scalability": {
      "watched_directories_per_instance": 20,
      "files_per_workspace": 500000,
      "horizontal_scaling": "multiple shadow containers"
    }
  },
  "monitoring_observability": [
    {
      "Minor text changes": "Git -> JJ"
    }
  ],
  "deployment_specifications": {
    "two_container_deployment": [
      "backup-bot (Go binary)",
      "jj-sidecar (Jujutsu runtime)"
    ],
    "details": [
      "Run rootless",
      "Connect via gRPC or Unix socket",
      "Shared host mount for data",
      "Persistent volumes for state, oplog, and store"
    ],
    "scaling": [
      "Multiple jj-sidecar instances",
      "Sharded repositories"
    ]
  },
  "compliance_data_sovereignty": [
    "No changes except terminology (Git -> Git/JJ)"
  ]
}